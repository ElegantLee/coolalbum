"use strict";!function(){var m="undefined"!=typeof window&&void 0!==window.document?window.document:{},e="undefined"!=typeof module&&module.exports,h={clickSearchBtn:function(){var e=$(".js_photographer_search_kw").val();window.location.href="/photographers/?"+Util.stringfyQueryString({kw:e})},searchPhotographers:function(e){$(".js_photographer_search_kw").on("keydown",function(e){13==e.keyCode&&h.clickSearchBtn()});var a=Util.getQueryString("kw");$(".js_photographer_search_kw").val(a),layui.use("flow",function(){layui.flow.load({elem:"#photographers-list",end:"都被你看光啦！",mb:500,done:function(n,l){var s=[],d=Util.parseQueryString();d.page=n||1,d.page_size=48;var e={url:"/share/user/search",data:d};Util.ajax(e).then(function(e){if(1==n&&0==e.count)return Global.emptyStateTips("photographers-list","暂无符合条件的摄影师！"),!1;var a=e.list,t=a.length;layui.each(a,function(e,a){var t=Global.photographerItem(a);s.push(t)}),l(s.join(""),0!=t&&t==d.page_size),$(".lazy-img").lazyload();for(var i=[],r=0,o=a.length;r<o;r++)i.push(a[r].id);Global.isFans(i)})}})})},zoneImgUpToken:function(){Util.ajax({url:"/share/zone/ZoneImgUpToken"}).then(function(e){$("#update_cover").off("click"),$("#update_cover").on("click",function(){h.uploadCoverImage(e)})})},fileSelectHandler:function(v){var e=m.getElementById("imageFile").files[0];if(/^(image\/jpeg|image\/jpg|image\/png)$/i.test(e.type))if(31457280<e.size)layer.msg("图片大小不能大于30M");else{var g=m.getElementById("jcropTarget"),a=new FileReader;a.readAsDataURL(e),a.onload=function(e){g.src=e.target.result,g.onload=function(){$(".jcrop-holder").remove();var e=$(".canvas-jcrop-preview-thumb"),s=e.width(),d=e.height(),a=$.Jcrop("#jcropTarget",{onChange:l,onSelect:l,onDblClick:function(){h.setData(v)},aspectRatio:3.2,boxWidth:400,boxHeight:400}),t=a.getBounds(),i=t[0],r=t[1],o=a.getWidgetSize(),c=o[0],u=o[1],n=a.getScaleFactor(),p=n[0],f=n[1];function l(e){if(0<parseInt(e.w)){var a=m.getElementById("myCanvas").getContext("2d"),t=m.getElementById("jcropTarget"),i=g.width,r=g.height,o=i/c,n=r/u,l=0;l=n<=o?o:n,a.drawImage(t,e.x/p*l,e.y/f*l,e.w/p*l,e.h/f*l,0,0,s,d)}}r<i?a.setSelect([0,(c-u/p)/2,i,r]):a.setSelect([0,(r-c/f)/2,i,r]),m.getElementById("cutImage").addEventListener("click",function(){h.setData(v)})}}}else layer.msg("请选择jpg和png格式的图片")},setData:function(e){layer.msg("正在处理，请稍候！",{time:1e4});var a=m.getElementById("myCanvas").toDataURL(),t=a.split(",")[0].match(/:(.*?);/)[1].length,i=parseInt(t+13);a=a.substring(i);var r=e.token,o=e.keyPrefix,n=e.upload_domain;h.putb64(r,o,a,n)},putb64:function(e,a,t,i){var r=Util.fileSize(t),o=Util.URLSafeBase64Encode(a+".jpg"),n=t,l="//"+i+"/putb64/"+r+"/key/"+o,s=new XMLHttpRequest;s.onreadystatechange=function(){if(4==s.readyState){var e=s.responseText,a={url:JSON.parse(e).hReturnUrl,type:"post",data:{upload_ret:e}};Util.ajax(a).then(function(e){$(".js_zoneimg").attr("src","data:image/png;base64,"+t),layer.closeAll(),layer.msg("更新成功"),h.zoneImgUpToken()})}},s.open("POST",l,!0),s.setRequestHeader("Content-Type","application/octet-stream"),s.setRequestHeader("Authorization","UpToken "+e),s.send(n)},uploadCoverImage:function(e){layer.open({type:1,title:"设置封面",shadeClose:!1,shade:[.8],area:["480px"],maxmin:!1,scrollbar:!1,content:'<div class="canvas-jcrop">\n        <div class="canvas-jcrop-preview">\n          <div class="canvas-jcrop-preview-original">\n            <img src="" id="jcropTarget">\n          </div>\n          <div class="canvas-jcrop-preview-thumb layui-hide" style="width: 1920px;height: 600px;">\n            <canvas class="canvas" id="myCanvas" width="1920" height="600"></canvas>\n          </div>\n        </div>\n        <div class="upload-btn t-bg-rose">\n          <span class="upload-btn-tit">选择图片</span>\n          <input class="file-btn" id="imageFile" type="file">\n        </div>\n        <div class="upload-btn t-bg-rose" id="cutImage">保存更改</div>\n      </div>'}),$("#imageFile").change(function(){h.fileSelectHandler(e)})},getZoneProducts:function(e){layui.use("flow",function(){layui.flow.load({elem:"#product-flex-images",end:"都被你看光啦！",mb:500,done:function(n,l){var s=[],d={url:"/share/zone/Products",data:{user_id:$("#to_user_id").val(),page:n||1,page_size:50}};Util.ajax(d).then(function(e){if(1==n&&0==e.count)return Global.emptyStateTips("product-flex-images","没有作品噢！"),!1;var a=e.list,t=a.length;layui.each(a,function(e,a){var t=Global.flexImagesItem(a,{ajaxObj:d});s.push(t)}),l(s.join(""),0!=t&&t==d.data.page_size),Global.flexImages(),$(".lazy-img").lazyload();for(var i=[],r=0,o=a.length;r<o;r++)i.push(a[r].id);Global.isLikeAndFav(i)})}})})},getFolderOrFavoriteLists:function(s,e){var d=$("#to_user_id").val(),c=$("#cur_login_user_id").val(),u=["folder","favorite"],i={url:["/share/folder/getLists","/share/favorite/Lists"][s],data:{user_id:d,page:e||1,page_size:9}};Util.ajax(i).then(function(e){var a=e.count,t=e.list,l="";$(".js_"+u[s]+"_count").html(a),t.forEach(function(e){var a="";e.cover_img&&(a='data-src="'+e.cover_img.thumbkey+'-h500?_="');var t=0==s?e.product_count:e.statistic.products,i=0==s?"/photographers/"+d+"/folders?folder_id="+e.id+"&folder_name="+e.name:"/photographers/"+d+"/favorite?favorite_id="+e.id+"&favorite_name="+e.name,r="";0==e.is_default&&d==c&&(r='<div class="folder-item-operate">\n              <span class="js_del_'+u[s]+' icon-operate icon-operate-del" title="点击删除" data-id="'+e.id+'" data-name="'+e.name+'"></span>\n              <span class="js_edit_'+u[s]+' icon-operate icon-operate-edit" title="点击编辑" data-id="'+e.id+'" data-name="'+e.name+'" data-secrecy="'+e.is_secrecy+'"></span>\n            </div>');var o=e.is_secrecy,n="";1==o&&(n='<span class="t-ml1 t-size-sm t-gray">【仅自己可见】</span>'),l+=1==o&&d!=c?"":'<a href="'+i+'" class="layui-col-lg4 layui-col-md4 layui-col-sm6 layui-col-xs12">\n              <div class="folder-item">\n                '+r+'\n                <div class="default-thumb">\n                  <span class="folder-item-cover lazy-img" style="background: url(\'\') center center/cover no-repeat;" '+a+'></span>\n                </div>\n                <div class="folder-item-bd">\n                  <h2 class="name">'+e.name+n+'</h2>\n                  <p class="count">'+t+"张图片</p>\n                </div>\n              </div>     \n            </a>"}),m.getElementById(u[s]+"List").innerHTML=l,$(".lazy-img").lazyload(),a>i.data.page_size&&layui.use("laypage",function(){layui.laypage.render({elem:u[s]+"ListPage",count:e.count,limit:i.data.page_size,curr:i.data.page,theme:"#e55e6d",jump:function(e,a){a||h.getFolderOrFavoriteLists(s,e.curr)}})}),$(".js_del_"+u[s]).on("click",function(){event.preventDefault();var e=$(this).attr("data-id"),a=$(this).attr("data-name");h.delFolderOrFavorite(s,e,a)}),$(".js_edit_"+u[s]).on("click",function(){event.preventDefault();var e=$(this).attr("data-id"),a=$(this).attr("data-name"),t=$(this).attr("data-secrecy");h.updateFolderOrFavorite(s,e,a,t)})})},delFolderOrFavorite:function(t,e,a){var i=["/share/folder/getDel","/share/favorite/Del"],r={};0==t?r={folder_id:e}:1==t&&(r={favorite_id:e}),layer.confirm("确定删除名为“"+a+"”的"+["专辑","收藏夹"][t]+"吗？",{icon:3,title:"操作确认"},function(a){var e={url:i[t],data:r};Util.ajax(e).then(function(e){h.getFolderOrFavoriteLists(t),layer.msg("删除成功！"),layer.close(a)})})},updateFolderOrFavorite:function(i,r,e,a){var t=["专辑","收藏夹"],o="";1==i&&(o='<div class="layui-form-item">\n          <label class="layui-form-label">仅自己可见</label>\n          <div class="layui-input-block">\n            <input type="radio" name="is_secrecy" value="1" title="是" '+(1==a?"checked":"")+'>\n            <input type="radio" name="is_secrecy" value="0" title="否" '+(0==a?"checked":"")+">\n          </div>\n        </div>");var n='<form class="layui-form" style="padding: 20px 50px 20px 20px;">\n        <div class="layui-form-item">\n          <label class="layui-form-label">'+t[i]+'名称</label>\n          <div class="layui-input-block">\n            <input type="text" name="name" required lay-verify="required" value="'+e+'" placeholder="请输入'+t[i]+'名称" autocomplete="off" class="layui-input">\n          </div>\n        </div>\n        '+o+'\n        <div class="layui-form-item">\n          <div class="layui-input-block">\n            <button class="layui-btn t-bg-rose" lay-submit lay-filter="updateFolderOrFavoriteForm">确定</button>\n          </div>\n        </div>\n      </form>';layer.open({type:1,title:"编辑"+t[i],shadeClose:!1,shade:[.8],area:"500px",maxmin:!1,content:n});var l=layer.index;layui.use("form",function(){var e=layui.form;e.render(),e.on("submit(updateFolderOrFavoriteForm)",function(e){var a={};0==i?a={name:Util.trim(e.field.name,"g"),folder_id:r}:1==i&&(a={name:Util.trim(e.field.name,"g"),favorite_id:r,is_secrecy:e.field.is_secrecy});var t={url:["/share/folder/getEdit","/share/favorite/Edit"][i],data:a};return Util.ajax(t).then(function(e){h.getFolderOrFavoriteLists(i),layer.msg("更新成功"),layer.close(l)}),!1})})},getFolderOrFavoriteProducts:function(e){var u=0,a=Util.getQueryString("folder_id"),t=Util.getQueryString("favorite_id");a?u=0:t&&(u=1);var p=["folder","favorite"],i=["/share/folder/getFolderProducts","/share/favorite/FavoriteProducts"],r={};0==u?r={folder_id:a,page:e,page_size:20}:1==u&&(r={favorite_id:t,page:e,page_size:20}),layui.use("flow",function(){layui.flow.load({elem:"#"+p[u]+"ProductFlexImages",end:"都被你看光啦！",mb:500,done:function(n,l){r.page=n;var s=[],d=!1,c={url:i[u],data:r};$("#to_user_id").val()==$("#cur_login_user_id").val()&&(d=!0),Util.ajax(c).then(function(e){if(1==n&&0==e.count)return Global.emptyStateTips(p[u]+"ProductFlexImages","没有作品！"),!1;var a=e.list,t=a.length;layui.each(a,function(e,a){var t=Global.flexImagesItem(a,{ajaxObj:c,isShowTopOver:d});s.push(t)}),l(s.join(""),0!=t&&t==c.data.page_size),layui.use("form",function(){layui.form.render("checkbox"),Global.selectAllCheckbox(),Global.selectOneCheckbox()}),Global.flexImages(),$(".lazy-img").lazyload();for(var i=[],r=0,o=a.length;r<o;r++)i.push(a[r].id);Global.isLikeAndFav(i),$(".js_set_cover").on("click",function(){event.preventDefault();var e=$(this).attr("data-id"),a=0==u?Util.getQueryString("folder_id"):Util.getQueryString("favorite_id");h.setCover(u,a,e)})})}})})},delFolderOrFavoriteProducts:function(i,r){var o=Global.getCheckedIds(),e=o.length,n=["/share/folder/getDelProduct","/share/favorite/DelProduct"];if(0==e)return layer.msg("请选择需要删除的作品"),!1;layer.confirm("确定删除选中的作品吗",{icon:3,title:"操作确认",btn:["删除","算了"]},function(e){var a={};0==i?a={folder_id:r,product_ids:o}:1==i&&(a={favorite_id:r,product_ids:o});var t={url:n[i],data:a};Util.ajax(t).then(function(e){layer.msg("删除成功");for(var a=0,t=o.length;a<t;a++)$('.flex-images-item[data-id="'+o[a]+'"]').remove();Global.flexImages()})})},moveFolderOrFavoriteProducts:function(o,n){var l=Global.getCheckedIds(),e=l.length,s=["/share/folder/getMove","/share/favorite/Move"];if(0==e)return layer.msg("请选择需要转移的作品"),!1;var a='<form class="layui-form" action="">\n        <div class="layui-form-item t-p5" style="min-height: 250px;">\n          <div class="layui-row" id="'+["folder","favorite"][o]+'_list"></div>\n        </div>\n        <div class="layui-form-item t-align-center">\n          <button class="layui-btn t-bg-rose" lay-submit lay-filter="productsMoveForm">确定移动</button>\n        </div>\n      </form>';layui.use("layer",function(){var i=layui.layer;i.open({type:1,title:"移动图片",shadeClose:!1,shade:[.8],area:["500px"],maxmin:!1,content:a}),0==o?Global.getFolderList():1==o&&Global.getFavoriteList();var r=i.index;layui.use("form",function(){var e=layui.form;e.render(),e.on("submit(productsMoveForm)",function(e){var a=0==o?e.field.folder_id:e.field.favorite_id,t={url:s[o],data:{old_fid:n,new_fid:a,product_ids:l}};return Util.ajax(t).then(function(e){i.msg("移动成功"),i.close(r);for(var a=0,t=l.length;a<t;a++)$('.flex-images-item[data-id="'+l[a]+'"]').remove();Global.flexImages()}),!1})})})},setCover:function(t,i,r){var o=["/share/folder/getChangeImg","/share/favorite/ChangeImg"],n={};layer.confirm("确定把该作品设置为封面吗",{icon:3,title:"操作确认"},function(a){0==t?n={folder_id:i,cover_img_id:r}:1==t&&(n={favorite_id:i,cover_img_id:r});var e={url:o[t],data:n};Util.ajax(e).then(function(e){layer.msg("设置成功！"),layer.close(a)})})},getUserArticleLists:function(){var e=$("#to_user_id").val();layui.use("flow",function(){layui.flow.load({elem:"#userArticleLists",end:"都被你看光啦！",mb:500,done:function(i,r){var o=[],n={url:"/api/articles/user/"+e,data:{page:i||1,page_size:20}};Util.ajax(n).then(function(e){if(1==i&&0==e.count)return Global.emptyStateTips("userArticleLists","暂无图文"),!1;var a=e.list,t=a.length;layui.each(a,function(e,a){var t=ArticleBase.articleItem(a);o.push(t)}),r(o.join(""),0!=t&&t==n.data.page_size),$(".lazy-img").lazyload()})}})})},getFavoritesArticleLists:function(){layui.use("flow",function(){layui.flow.load({elem:"#favoritesArticleList",end:"都被你看光啦！",mb:500,done:function(i,r){var o=[],n=!1,e=$("#to_user_id").val(),a=$("#cur_login_user_id").val(),l={url:"/api/articles/user/"+e+"/favorites",data:{page:i||1,page_size:20}};e==a&&(n=!0),Util.ajax(l).then(function(e){if(1==i&&0==e.count)return Global.emptyStateTips("favoritesArticleList","暂无收藏的图文"),!1;var a=e.list,t=a.length;layui.each(a,function(e,a){var t=ArticleBase.articleItem(a,{isShowTopOver:n});o.push(t)}),r(o.join(""),0!=t&&t==l.data.page_size),$(".lazy-img").lazyload()})}})})},changeFavoriteType:function(){$(".js_favorite_tab li").click(function(){var e=$(this).attr("data-type");$('.js_favorite_tab li[data-type="'+e+'"]').addClass("active").siblings(".js_favorite_tab li").removeClass("active"),$('.js_favorite_list[data-type="'+e+'"]').removeClass("t-hide").siblings(".js_favorite_list").addClass("t-hide")}),this.getFolderOrFavoriteLists(1),this.getFavoritesArticleLists()},getZoneFans:function(e){layui.use("flow",function(){layui.flow.load({elem:"#fans-list",end:"没有更多粉丝啦！",isLazyimg:!0,mb:500,done:function(o,n){var l=[],s={url:"/share/zone/Fans",data:{page:o||1,page_size:48,user_id:$("#to_user_id").val()}};Util.ajax(s).then(function(e){if(1==o&&0==e.count)return Global.emptyStateTips("fans-list","没有粉丝噢！"),!1;var a=e.list;layui.each(a,function(e,a){var t='<div class="layui-col-lg3 layui-col-md3 layui-col-sm4 layui-col-xs12">\n                  <div class="photographer-item">\n                    <div class="photographer-item-bd">\n                      <a href="/photographers/'+a.user.id+'/product" target="_blank" rel="noreferrer noopener">\n                        <div class="photographer-item-avatar lazy-img" data-src="'+a.user.avatar+'"></div>\n                        <h2 class="nickname">'+a.user.nickname+'</h2>\n                      </a>\n                      <div class="statistic">\n                        <span class="t-mr2">作品 '+a.user.statistic.products+'</span>\n                        <span class="t-mr2">人气 '+a.user.statistic.popular+"</span>\n                        <span>粉丝 "+a.user.statistic.fans+'</span>\n                      </div>\n                      <a class="default-thumb" href="/photographers/'+a.user.id+'/product" target="_blank" rel="noreferrer noopener">\n                        <div class="photographer-item-cover lazy-img" style="background: url(\'\') center center/cover no-repeat;" data-src="'+a.user.zoneimg+'-min400x300"></div>\n                      </a>\n                      <span class="t-mt3 follow-btn js_follow_btn" data-id="'+a.user.id+'">关 注</span>\n                    </div>\n                  </div>\n                </div>';l.push(t)}),n(l.join(""),o<e.count/s.data.page_size),$(".lazy-img").lazyload();for(var t=[],i=0,r=a.length;i<r;i++)t.push(a[i].user.id);Global.isFans(t)})}})})},getZoneFansTo:function(e){layui.use("flow",function(){layui.flow.load({elem:"#follows-list",end:"没有更多关注的摄影师啦！",done:function(o,n){var l=[],s={url:"/share/zone/FansTo",data:{page:o||1,page_size:48,user_id:$("#to_user_id").val()}};Util.ajax(s).then(function(e){if(1==o&&0==e.count)return Global.emptyStateTips("follows-list","没有关注的摄影师噢！"),!1;var a=e.list;layui.each(a,function(e,a){var t='<div class="layui-col-lg3 layui-col-md3 layui-col-sm4 layui-col-xs12">\n                  <div class="photographer-item">\n                    <div class="photographer-item-bd">\n                      <a href="/photographers/'+a.to_user.id+'/product" target="_blank" rel="noreferrer noopener">\n                        <div class="photographer-item-avatar lazy-img" style="background: url(https://static.tantupix.com/pc/images/default_avatar.jpg) center center/cover no-repeat;" data-src="'+a.to_user.avatar+'"></div>\n                        <h2 class="nickname">'+a.to_user.nickname+'</h2>\n                      </a>\n                      <div class="statistic">\n                        <span class="t-mr2">作品 '+a.to_user.statistic.products+'</span>\n                        <span class="t-mr2">人气 '+a.to_user.statistic.popular+"</span>\n                        <span>粉丝 "+a.to_user.statistic.fans+'</span>\n                      </div>\n                      <a class="default-thumb" href="/photographers/'+a.to_user.id+'/product" target="_blank" rel="noreferrer noopener">\n                        <div class="photographer-item-cover lazy-img" style="background: url(\'\') center center/cover no-repeat;" data-src="'+a.to_user.zoneimg+'-min400x300"></div>\n                      </a>\n                      <span class="t-mt3 follow-btn js_follow_btn" data-id="'+a.to_user.id+'">关 注</span>\n                    </div>\n                  </div>\n                </div>';l.push(t)}),n(l.join(""),o<e.count/s.data.page_size),$(".lazy-img").lazyload();for(var t=[],i=0,r=a.length;i<r;i++)t.push(a[i].to_user.id);Global.isFans(t)})}})})},getPhotographerData:function(e){var a=$("#to_user_id").val();if($("#cur_login_user_id").val()==a&&this.zoneImgUpToken(),"product"==e)this.getZoneProducts(1);else if("articles"==e)this.getUserArticleLists();else if("folders"==e){Util.getQueryString("folder_id")?this.getFolderOrFavoriteProducts(1):this.getFolderOrFavoriteLists(0)}else if("favorite"==e){Util.getQueryString("favorite_id")?this.getFolderOrFavoriteProducts(1):this.changeFavoriteType()}else"fans"==e?this.getZoneFans(1):"follows"==e&&this.getZoneFansTo(1)}};e?module.exports=h:window.Photographers=h}();